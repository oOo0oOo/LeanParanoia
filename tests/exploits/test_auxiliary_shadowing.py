import pytest


@pytest.mark.exploit
@pytest.mark.xfail(reason="Not implemented")
def test_matcher_shadowing_valid(verifier):
    """Normal case: both definitions create their own matchers"""
    result = verifier.verify_theorem(
        "LeanTestProject.AuxiliaryShadowing.MatcherShadowing", "test1"
    )
    assert not result.success


@pytest.mark.exploit
@pytest.mark.xfail(reason="Not implemented")
def test_matcher_cross_reference_rejected(verifier):
    """Cross-reference: foo uses bar.match_1, exploit uses foo"""
    result = verifier.verify_theorem(
        "LeanTestProject.AuxiliaryShadowing.ProofShadowing", "exploit"
    )
    assert not result.success
    assert "AuxiliaryShadowing" in result.failed_tests


@pytest.mark.exploit
@pytest.mark.xfail(reason="Not implemented")
def test_sunfold_cross_reference_rejected(verifier):
    """Cross-reference: foo uses bar._sunfold, exploit uses foo"""
    result = verifier.verify_theorem(
        "LeanTestProject.AuxiliaryShadowing.PrivateShadowing", "exploit"
    )
    assert not result.success
    assert "AuxiliaryShadowing" in result.failed_tests


@pytest.mark.exploit
@pytest.mark.xfail(reason="Not implemented")
def test_theorem_uses_auxiliary_rejected(verifier):
    """Theorem directly uses auxiliary matcher from another definition"""
    result = verifier.verify_theorem(
        "LeanTestProject.AuxiliaryShadowing.TheoremShadowing", "exploit"
    )
    assert not result.success
    assert "AuxiliaryShadowing" in result.failed_tests


@pytest.mark.exploit
@pytest.mark.xfail(reason="Not implemented")
def test_type_signature_uses_auxiliary_rejected(verifier):
    """Definition with auxiliary name in type signature"""
    result = verifier.verify_theorem(
        "LeanTestProject.AuxiliaryShadowing.TypeSignature", "exploit"
    )
    assert not result.success
    assert "AuxiliaryShadowing" in result.failed_tests
