"""
Tests for kernel rejection cases.

These test files contain code that the Lean kernel rejects during compilation.
The tests verify that the verifier handles build failures gracefully.
"""

import pytest


@pytest.mark.exploit
def test_kernel_reject_unsafe_cast(verifier, default_config):
    """Test that verifier handles kernel rejection of unsafeCast gracefully."""
    result = verifier.verify_theorem(
        "LeanTestProject.KernelReject.UnsafeCast",
        "exploit_theorem",
        config=dict(default_config),
    )

    assert not result.success
    # Kernel rejects the file, so module can't be imported
    assert "KernelTypeCheck" in result.failed_tests
    assert "does not exist" in str(result.errors)


@pytest.mark.exploit
def test_kernel_reject_non_positive(verifier, default_config):
    """Test that verifier handles kernel rejection of non-positive inductives."""
    result = verifier.verify_theorem(
        "LeanTestProject.KernelReject.NonPositive",
        "exploit_theorem",
        config=dict(default_config),
    )

    assert not result.success
    # Kernel rejects the file, so module can't be imported
    assert "KernelTypeCheck" in result.failed_tests
    assert "does not exist" in str(result.errors)
