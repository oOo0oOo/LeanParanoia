"""Tests for opaque definition exploit coverage gaps."""

import pytest


@pytest.mark.exploit
def test_opaque_sorry_hidden(verifier, default_config):
    """Opaque constants with `sorry` bodies should not pass verification."""
    result = verifier.verify_theorem(
        "LeanTestProject.Opaque.Sorry",
        "exploit_theorem",
        config=dict(default_config),
    )

    assert not result.success
    assert "NoSorry" in result.failed_tests


@pytest.mark.exploit
def test_opaque_sorry_hidden_when_disabled(verifier, default_config):
    """Disabling opaque body inspection should allow the exploit to pass."""
    config = dict(default_config)
    config["checkOpaqueBodies"] = False

    result = verifier.verify_theorem(
        "LeanTestProject.Opaque.Sorry",
        "exploit_theorem",
        config=config,
    )

    assert result.success
