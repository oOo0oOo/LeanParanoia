"""Tests for opaque definition exploit coverage gaps."""

import pytest


@pytest.mark.exploit
def test_opaque_sorry_hidden(verifier):
    """Opaque constants with `sorry` bodies should not pass verification."""
    result = verifier.verify_theorem(
        "LeanTestProject.Opaque.Sorry",
        "exploit_theorem",
    )

    assert not result.success
    assert "NoSorry" in result.failed_tests


@pytest.mark.exploit
def test_opaque_sorry_hidden_when_disabled(verifier):
    """Disabling opaque body inspection should allow the exploit to pass."""
    result = verifier.verify_theorem(
        "LeanTestProject.Opaque.Sorry",
        "exploit_theorem",
        check_opaque_bodies=False,
    )

    assert result.success
